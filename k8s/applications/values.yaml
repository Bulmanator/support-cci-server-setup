circleci-server-version: "4.9.0"

argocd:
  repository: https://github.com/Bulmanator/support-cci-server-setup.git

global:
  clusterName: "jb-cci"
  aws:
    region: eu-west-2
  domainFilter: circleci-labs.com  # Base domain for Route53
  domainName: "jb-server.circleci-labs.com"  # Change to your desired subdomain (e.g., "mycci.ka-cci.com") or root domain (e.g., "ka-cci.com")
  otel:
    enabled: true
    collector_host: "jaeger-collector.monitoring.svc.cluster.local"
    collector_port: 4317
    sample_rate: 1.0
  imagePullSecrets:
    - regcred
    - dockerhub-secret
  container:
    # pulls from dockerhub
    registry: ""
    org: "circleci"

machine_provisioner:
  fudgeScaleFactor: 0
  fudgeConstantTerm: 0
  demandFudgeFactor: 0
  providers:
    ec2:
      enabled: true
      region: "eu-west-2"
      assignPublicIP: true
      irsaRole: "eks-pod-identity"
      subnets:
        - "subnet-0e20ace77b875c808"
        - "subnet-0177124c8a8f7741d"
        - "subnet-07596407c02d74c7c"
      securityGroupId: "sg-0d324da3c2f251a90"
      tags:
        owner: "james.bulman@circleci.com"
        cost_center: "sm"
        Team: "customer_engineering"
        asset_criticality: "false"
        iac: "false"
        critical_until: "2026-12-30"
        Terraform: "false"

# Hack. We are running kong for cert management but need to use annotation to allow external-dns to manage the DNS record.
nginx:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: jb-server.circleci-labs.com app.jb-server.circleci-labs.com
  resources:
    requests:
      cpu: 50m
      memory: 100Mi
    limits:
      cpu: 100m
      memory: 200Mi

kong:
  acme:
    enabled: true
    email: james.bulman@circleci.com
  resources:
    requests:
      cpu: 50m
      memory: 1Gi
    limits:
      cpu: 500m
      memory: 2Gi

object_storage:
  bucketName: "jb-cci-cci"
  s3:
    enabled: true
    endpoint: https://s3.eu-west-2.amazonaws.com
    region: eu-west-2
    irsaRole: "eks-pod-identity" # Hack to allow pod identity instead of irsa

github:
  enterprise: false

oidc_service:
  isEnabled: true
  json_web_keys: "in-secrets"

# Below are the rest, usually don't need to change these
postgresql:
  auth:
    existingSecret: postgresql
mongodb:
  auth:
    existingSecret: mongodb-credentials
rabbitmq:
  internal: true
  auth:
    existingPasswordSecret: rabbitmq
    existingErlangSecret: rabbitmq
tink:
  enabled: true
nomad:
  server:
    replicas: 3
    rpc:
      mTLS:
        enabled: true
telegraf:
  resources:
    requests:
      cpu: 50m
      memory: 100Mi
    limits:
      cpu: 100m
      memory: 200Mi
  service:
    ports:
      - name: statsd
        port: 8125
        protocol: UDP
        targetPort: 8125
      - name: prometheus
        port: 9273
        protocol: TCP
        targetPort: 9273
  config:
    outputs:
      - file:
          files: ["stdout"]
      - prometheus_client:
          listen: ":9273"
          metric_version: 2
          expiration_interval: "60s"
